<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Î∞©Í∏à ÏàòÏ†ïÌïú Í≤É</title>

  <style>
    html, body {
      cursor: url("/TeamNetflix1/img/cur/basic_cur.png"), auto;
    }
    button, a, [role="button"] {
      cursor: url("/TeamNetflix1/img/cur/click_cur.png"), pointer;
    }
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .stage {
      position: relative;
      width: 926px;
      height: 574px;
      background: url('img/food/bg.png') no-repeat center center;
      background-size: contain;
    }
    .circle {
      position: absolute;
      width: 342px;
      height: 342px;
      border-radius: 50%;
      top: 126px;
      left: 83px;
    }
    .box {
      position: absolute;
      width: 333px;
      height: 431px;
      top: 71px;
      right: 76px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .food {
      position: absolute;
      user-select: none;
      cursor: url("/TeamNetflix1/img/cur/click_cur.png"), pointer;
      transition: transform 0.15s ease;
      will-change: transform, left, top;
    }
    .food.dragging {
      opacity: 0.9;
      transform: scale(1.06);
      transition: none;
      z-index: 999;
    }
  </style>
</head>
<body>

<div class="stage" id="stage">
  <div class="circle" id="circle"></div>
  <div class="box" id="box"></div>
</div>

<script>
// DOM ÏöîÏÜå
const stage = document.getElementById('stage');
const circle = document.getElementById("circle");
const box = document.getElementById("box");

// ÏùåÏãù Îç∞Ïù¥ÌÑ∞
const foods = [
  { name: "BREATHE", size: [135, 47] },
  { name: "CORRECT", size: [121, 45] },
  { name: "DIG", size: [55, 48] },
  { name: "ELECTRIC", size: [130, 43] },
  { name: "GLASS", size: [106, 32] },
  { name: "KID", size: [58, 44] },
  { name: "NETFLIX", size: [137, 36] },
  { name: "SUSTAIN", size: [121, 43] },
  { name: "TRICK", size: [88, 36] },
  { name: "XERASIA", size: [143, 46] }
];

const circleRadius = 342 / 2;
const placedFoods = [];
const boxItems = [];

// ÏãùÌíàÏù¥ Ïõê ÎÇ¥Î∂ÄÏóê ÏôÑÏ†ÑÌûà Îì§Ïñ¥Í∞ÄÏûàÎäîÏßÄ Í≤ÄÏÇ¨
function insideCircleAllCorners(x, y, w, h, radius) {
  const cx = radius;
  const cy = radius;
  const corners = [
    [x, y], [x+w, y],
    [x, y+h], [x+w, y+h]
  ];
  return corners.every(([px, py]) => {
    const dx = px - cx;
    const dy = py - cy;
    return Math.sqrt(dx*dx + dy*dy) <= radius;
  });
}

// ‚úÖ Ï¥àÍ∏∞ Ïõê ÎÇ¥Î∂Ä Ï§ëÎ≥µ ÏóÜÏù¥ Î∞∞Ïπò
foods.forEach(food => {
  const img = document.createElement("img");
  img.src = `img/food/${food.name}.png`;
  img.className = "food";
  
  const [w, h] = food.size;
  img.style.width = `${w}px`;
  img.style.height = `${h}px`;

  let x=0, y=0, tries=0;
  const maxTries=800;
  while(tries < maxTries){
    const angle = Math.random()*2*Math.PI;
    const r = Math.random()*(circleRadius - Math.max(w,h)/2);
    const cx = circleRadius + Math.cos(angle)*r;
    const cy = circleRadius + Math.sin(angle)*r;

    x = cx - w/2;
    y = cy - h/2;

    // Ïõê Î∞ñÏù¥Î©¥ Ï∑®ÏÜå
    if(!insideCircleAllCorners(x,y,w,h,circleRadius)){ tries++; continue; }

    // Í∏∞Ï°¥ ÏùåÏãùÍ≥º Ï∂©Îèå Ïó¨Î∂Ä
    let overlap = false;
    for(const p of placedFoods){
      const dx = (x+w/2) - (p.x+p.w/2);
      const dy = (y+h/2) - (p.y+p.h/2);
      if(Math.sqrt(dx*dx+dy*dy) < (Math.max(w,p.w))){
        overlap = true;
        break;
      }
    }
    if(!overlap) break;
    tries++;
  }

  img.style.left = `${x}px`;
  img.style.top = `${y}px`;
  img.dataset.originalLeft = x;
  img.dataset.originalTop = y;
  img.dataset.inBox = "false";

  placedFoods.push({ x,y,w,h });
  circle.appendChild(img);
});

// üîπ ÎìúÎûòÍ∑∏ Í¥ÄÎ†® Î≥ÄÏàò
let dragged = null;
let offsetX = 0, offsetY = 0;
let originalX = 0, originalY = 0;

// Ï¢åÌëú Î≥ÄÌôò Stage Í∏∞Ï§Ä
function clientToStagePos(clientX, clientY) {
  const rect = stage.getBoundingClientRect();
  return {
    x: clientX - rect.left,
    y: clientY - rect.top
  };
}

// ‚úÖ ÎìúÎûòÍ∑∏ ÌôúÏÑ±Ìôî
function enableDraggingForFoods() {
  document.querySelectorAll(".food").forEach(img => {
    img.addEventListener("mousedown", e => {
      e.preventDefault();
      dragged = img;
      dragged.classList.add("dragging");

      const rect = img.getBoundingClientRect();
      const stageRect = stage.getBoundingClientRect();

      originalX = rect.left - stageRect.left;
      originalY = rect.top - stageRect.top;

      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;

      stage.appendChild(img); // stage Í∏∞Ï§Ä Ï†àÎåÄ ÏúÑÏπò
      img.style.left = `${originalX}px`;
      img.style.top = `${originalY}px`;

      document.addEventListener("mousemove", onMouseMove);
      document.addEventListener("mouseup", onMouseUp);
    });
  });
}

function onMouseMove(e) {
  if (!dragged) return;
  const pos = clientToStagePos(e.clientX, e.clientY);
  dragged.style.left = `${pos.x - offsetX}px`;
  dragged.style.top = `${pos.y - offsetY}px`;
}

// ‚úÖ Î∞ïÏä§ Ï†ïÎ†¨
const GAP = 2;
// ‚úÖ Î∞ïÏä§ Î†àÏù¥ÏïÑÏõÉ Í∞±Ïã† (ÏàòÏ†ïÎêú Î≤ÑÏ†Ñ)
function updateBoxLayout() {
  let yCursor = GAP;

  boxItems.forEach(item => {
    const w = item.offsetWidth;
    const h = item.offsetHeight;

    const centerX = (box.clientWidth - w) / 2;
    item.style.left = `${centerX}px`;
    item.style.top = `${yCursor}px`;

    // ‚úÖ DOM Í≥ÑÏ∏µÏùÑ ÌôïÏã§Ìûà Î∞ïÏä§ ÏïàÏúºÎ°ú Ïù¥Îèô
    box.appendChild(item);

    yCursor += h + GAP;
  });
}


// ‚úÖ ÎßàÏö∞Ïä§ ÎñºÍ∏∞ Ï≤òÎ¶¨ (ÌïµÏã¨ ÏàòÏ†ï ÏôÑÎ£å)
// ‚úÖ ÎßàÏö∞Ïä§ ÎñºÍ∏∞ Ï≤òÎ¶¨ (ÌïµÏã¨ ÏàòÏ†ï ÏôÑÎ£å)
function onMouseUp() {
  if (!dragged) return;

  const img = dragged;
  const rect = img.getBoundingClientRect();
  const stageRect = stage.getBoundingClientRect();
  const boxRect = box.getBoundingClientRect();

  const x = rect.left - stageRect.left;
  const y = rect.top - stageRect.top;

  const insideBox = (
    rect.right > boxRect.left &&
    rect.left < boxRect.right &&
    rect.bottom > boxRect.top &&
    rect.top < boxRect.bottom
  );

  if (insideBox) {
    // ‚úÖ Î∞ïÏä§Î°ú Ïù¥Îèô
    img.dataset.inBox = "true";

    const oldIndex = boxItems.indexOf(img);
    if (oldIndex !== -1) boxItems.splice(oldIndex, 1);

    const middleY = rect.top + rect.height / 2;
    let newIndex = boxItems.findIndex(el => {
      const r = el.getBoundingClientRect();
      return middleY < r.top + r.height / 2;
    });
    if (newIndex === -1) newIndex = boxItems.length;

    boxItems.splice(newIndex, 0, img);
    box.appendChild(img);

    // ‚úÖ Î∞ïÏä§ Î†àÏù¥ÏïÑÏõÉ Í∞±Ïã†
    updateBoxLayout();

  } else {
    // ‚úÖ Î∞ïÏä§ Î∞ñ ‚Üí ÏõêÎûò ÏûêÎ¶¨Î°ú Î≥µÍ∑Ä
    img.dataset.inBox = "false";

    img.style.left = `${img.dataset.originalLeft}px`;
    img.style.top = `${img.dataset.originalTop}px`;
    circle.appendChild(img);

    const idx = boxItems.indexOf(img);
    if (idx >= 0) boxItems.splice(idx, 1);
  }

  img.classList.remove("dragging");
  dragged = null;

  document.removeEventListener("mousemove", onMouseMove);
  document.removeEventListener("mouseup", onMouseUp);
}


// ‚≠ê Ï¥àÍ∏∞ ÎìúÎûòÍ∑∏ ÌôúÏÑ±Ìôî
enableDraggingForFoods();

</script>

</body>
</html>
