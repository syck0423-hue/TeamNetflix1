<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ÌåêÎã§ ÌÅ¥Î¶≠ Î¶¨Îì¨Í≤åÏûÑ</title>
<style>
  body {
    margin: 0;
    background: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .stage {
    position: relative;
    width: 926px;
    height: 574px;
    background: url("img/panda/bg.png") no-repeat center/cover;
    overflow: hidden;
  }

  .item { position: absolute; }

  .item1 { left: 343px; bottom: 152px; width: 259px; height: 343px; }
  .item2 { left: 96px; top: 45px; width: 239px; height: 307px; }
  .item3 { left: 57px; top: 433px; width: 237px; height: 304px; transition: transform 1s ease; cursor: pointer; }
  .item4 { right: 57px; top: 433px; width: 239px; height: 307px; transition: transform 1s ease; cursor: pointer; }
  .item5 { right: 74px; top: 74px; width: 236px; height: 87px; }

  .item3:hover, .item4:hover { transform: translateY(-30px); }
  .item3.clicked, .item4.clicked { transform: translateY(-160px); }

  .note {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 126px;
    height: 268px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 10;
  }

  #noteL { left: 5px; }
  #noteR { right: 5px; }
  .show { opacity: 1; }
</style>
</head>
<body>
  <div class="stage">
    <div class="item item1"><img id="pandaImg" src="img/panda/basic.gif"></div>
    <div class="item item2"><img id="textImg" src="img/panda/text.gif"></div>
    <div class="item item3" id="leftBtn"><img src="img/panda/left.gif"></div>
    <div class="item item4" id="rightBtn"><img src="img/panda/right.gif"></div>
    <div class="item item5"><img id="clearImg" src="img/panda/clear_0.png"></div>

    <!-- üéµ ÏùåÌëú ÌëúÏãú -->
    <img id="noteL" class="note" src="img/panda/soundL.gif" alt="ÏôºÏ™Ω ÏùåÌëú">
    <img id="noteR" class="note" src="img/panda/soundR.gif" alt="Ïò§Î•∏Ï™Ω ÏùåÌëú">
  </div>

  <script>
    const sequence = ["left", "left", "right", "left"];
    let currentRound = 0;
    const totalRounds = sequence.length;
    let gameEnded = false;
    let canClick = false; // üéØ ÌÅ¥Î¶≠ Í∞ÄÎä• Ïó¨Î∂Ä

    const noteL = document.getElementById("noteL");
    const noteR = document.getElementById("noteR");
    const clearImg = document.getElementById("clearImg");
    const pandaImg = document.getElementById("pandaImg");
    const textImg = document.getElementById("textImg");
    const leftBtn = document.getElementById("leftBtn");
    const rightBtn = document.getElementById("rightBtn");

    // üéµ ÏùåÌëú ÌëúÏãú
    function showNote() {
      if (gameEnded) return;
      canClick = true; // ‚úÖ ÌÅ¥Î¶≠ ÌóàÏö©

      noteL.classList.remove("show");
      noteR.classList.remove("show");

      const current = sequence[currentRound];
      if (current === "left") noteL.classList.add("show");
      else if (current === "right") noteR.classList.add("show");

      // 2Ï¥à Îí§ ÏûêÎèô ÏÇ¨ÎùºÏßê (ÌÅ¥Î¶≠ Ïïà ÌñàÏùÑ ÎïåÎßå)
      setTimeout(() => {
        if (canClick) {
          noteL.classList.remove("show");
          noteR.classList.remove("show");
          canClick = false;
        }
      }, 2000);
    }

    // üéÆ ÌÅ¥Î¶≠ Ï≤òÎ¶¨
    leftBtn.addEventListener("click", () => handlePress("left", leftBtn));
    rightBtn.addEventListener("click", () => handlePress("right", rightBtn));

    function handlePress(dir, btn) {
      if (gameEnded || !canClick) return; // ‚ùå ÏùåÌëú ÏóÜÏùÑ Îïå ÌÅ¥Î¶≠ Î¨¥Ìö®
      canClick = false; // Ï¶âÏãú ÌÅ¥Î¶≠ ÎπÑÌôúÏÑ±Ìôî

      // ÌÅ¥Î¶≠ Ïãú ÏùåÌëú Ï¶âÏãú ÏÇ¨ÎùºÏßê
      noteL.classList.remove("show");
      noteR.classList.remove("show");

      raiseSmoothly(btn, () => handleInput(dir)); // ÏÜêÏù¥ ÎÇ¥Î†§Í∞à Îïå ÌåêÏ†ï
    }

    // ÌÅ¥Î¶≠ Ïãú Ï≤úÏ≤úÌûà Ïò¨ÎùºÍ∞îÎã§ ÎÇ¥Î†§Ïò§Í∏∞ + ÏΩúÎ∞± Ïã§Ìñâ
    function raiseSmoothly(el, callback) {
      el.classList.add("clicked");
      setTimeout(() => {
        el.classList.remove("clicked");
        if (callback) callback(); // ÎÇ¥Î†§Ïò® ÌõÑ Ïã§Ìñâ
      }, 1000);
    }

    // ÏûÖÎ†• ÌåêÏ†ï
    function handleInput(dir) {
      if (dir === sequence[currentRound]) {
        showGood();
        currentRound++;
        clearImg.src = `img/panda/clear_${currentRound}.png`;

        if (currentRound < totalRounds) {
          setTimeout(showNote, 500); // ÏÜê ÎÇ¥Î†§Ïò® ÌõÑ ÏïΩÍ∞ÑÏùò ÌÖÄ ÌõÑ Îã§Ïùå ÏùåÌëú
        } else {
          showFinalClear();
        }
      } else {
        showBad();
        currentRound = 0;
        clearImg.src = "img/panda/clear_0.png";
        textImg.src = "img/panda/text.gif";
        setTimeout(showNote, 1000);
      }
    }

    // ‚úÖ GOOD Î∞òÏùë
    function showGood() {
      pandaImg.src = "img/panda/good.gif";
      setTimeout(() => (pandaImg.src = "img/panda/basic.gif"), 1000);
    }

    // ‚ùå BAD Î∞òÏùë
    function showBad() {
      pandaImg.src = "img/panda/bad.gif";
      setTimeout(() => (pandaImg.src = "img/panda/basic.gif"), 1000);
    }

    // üéâ 4ÎùºÏö¥Îìú ÌÅ¥Î¶¨Ïñ¥
    function showFinalClear() {
      gameEnded = true;
      clearImg.src = "img/panda/clear_4.png";
      pandaImg.src = "img/panda/good.gif";
      textImg.src = "img/panda/result.gif";
    }

    // üöÄ ÌéòÏù¥ÏßÄ Î°úÎìú ÌõÑ 2Ï¥à Îí§Ïóê Ï≤´ ÏùåÌëú ÌëúÏãú
    window.addEventListener("load", () => {
      setTimeout(showNote, 2000);
    });
  </script>
</body>
</html>
